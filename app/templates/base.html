<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}天气数据分析系统{% endblock %}</title>

    <!-- Bootstrap 样式与图标 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- 自定义样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
    {% block styles %}{% endblock %}
</head>

<body class="bg-light">
    <!-- ✅ 顶部导航栏 -->
    <nav class="top-navbar bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
                <i class="bi bi-cloud-sun-fill fs-3 me-2"></i>
                <h1 class="fs-4 m-0">辽宁省智慧旅游系统</h1>
            </div>
            <div class="d-flex align-items-center gap-3">
                {% if current_user.is_authenticated %}
                <!-- 用户下拉菜单 -->
                <div class="dropdown">
                    <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <i class="bi bi-person-circle me-1"></i> {{ current_user.username }}
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{{ url_for('user_profile.profile') }}"><i
                                    class="bi bi-person-fill me-2"></i> 个人资料</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('user_profile.favorites') }}"><i
                                    class="bi bi-star-fill me-2"></i> 我的收藏</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('user_profile.login_history') }}"><i
                                    class="bi bi-clock-history me-2"></i> 登录历史</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}"><i
                                    class="bi bi-box-arrow-right me-2"></i> 退出登录</a></li>
                    </ul>
                </div>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-box-arrow-in-right"></i> 登录
                </a>
                <a href="{{ url_for('auth.register') }}" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-person-plus-fill"></i> 注册
                </a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- ✅ 主容器 -->
    <div class="main-container">
        <!-- ✅ 左侧导航栏 -->
        <nav id="sidebar" class="bg-dark text-white flex-shrink-0 p-3">
            <div class="mb-4">
                <a href="{{ url_for('visualizations.system_menu') }}"
                    class="d-flex align-items-center text-white text-decoration-none">
                    <i class="bi bi-cloud-sun-fill fs-4 me-2"></i>
                    <span class="fs-5 fw-bold">系统菜单</span>
                </a>
            </div>
            <hr>
            <ul class="nav nav-pills flex-column mb-auto">
                <!-- 核心功能菜单 - 所有登录用户可见 -->
                {% if current_user.is_authenticated %}
                <li class="nav-item mb-1">
                    <a href="{{ url_for('visualizations.dashboard') }}"
                        class="nav-link text-white {% if request.endpoint == 'visualizations.dashboard' %}active{% endif %}">
                        <i class="bi bi-bar-chart-line me-2"></i> 可视化分析
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('map_view.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'map_view.index' %}active{% endif %}">
                        <i class="bi bi-geo-alt-fill me-2"></i> 地图可视化
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('tourism_decision_center.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'tourism_decision_center.index' %}active{% endif %}">
                        <i class="bi bi-compass-fill me-2"></i> 旅游决策中心
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('query_view.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'query_view.index' %}active{% endif %}">
                        <i class="bi bi-table me-2"></i> 数据查询
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('recommendation.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'recommendation.index' %}active{% endif %}">
                        <i class="bi bi-star-fill me-2"></i> 旅游推荐
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('path_optimization.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'path_optimization.index' %}active{% endif %}">
                        <i class="bi bi-geo-alt-fill me-2"></i> 路径优化
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('prediction.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'prediction.index' %}active{% endif %}">
                        <i class="bi bi-cloud-sun-fill me-2"></i> 天气预测
                    </a>
                </li>
                {% endif %}

                <!-- 管理功能菜单 - 仅管理员可见 -->
                {% if current_user.is_authenticated and current_user.is_admin() %}
                <li class="nav-item mb-1">
                    <hr class="text-white-30 my-2">
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('user_management.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'user_management.index' %}active{% endif %}">
                        <i class="bi bi-people-fill me-2"></i> 用户管理
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="{{ url_for('log_view.index') }}"
                        class="nav-link text-white {% if request.endpoint == 'log_view.index' %}active{% endif %}">
                        <i class="bi bi-journal-text me-2"></i> 日志查看
                    </a>
                </li>
                {% endif %}
            </ul>
            <hr>
            <div class="mt-4 text-white-50 small">© 2023 辽宁天气数据分析系统</div>
        </nav>

        <!-- ✅ 主体内容区域 -->
        <main>
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- ✅ JS 脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- 引入 Vue 3 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.js"></script>
    {% block scripts %}{% endblock %}
</body>

</html>